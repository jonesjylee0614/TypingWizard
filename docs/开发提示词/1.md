# TypingClub 学生端（纯前端离线版）功能清单与页面流转规格

> **目标**：仅保留学生端最核心闭环（课程 → 练习 → 成绩 → 历史/统计），无需后端。全部数据持久化到浏览器 **localStorage**。

---

## 1. 产品范围（MVP）

* **用户模式**：游客（无账号系统）。
* **核心功能**：

  1. 课程关卡（解锁机制）
  2. 打字练习（实时正确/错误反馈、键盘提示）
  3. 结果页（WPM、准确率、错误分布、星级）
  4. 本地成绩与进度（localStorage）
  5. 历史统计（按关卡与总体）
  6. 设置（音效、键盘提示、目标阈值等）
* **不包含**：登录/云同步/教师后台/多人/班级管理。

---

## 2. 信息架构（站点地图）

```
/                # 首页（欢迎/继续练习）
  ├─ /lessons    # 课程列表页
  │    └─ /lesson/:id   # 课程详情（预览关卡内容、目标）
  │          └─ /train/:id  # 练习页（核心互动）
  │                └─ /result/:id  # 结果页（单次成绩）
  ├─ /stats      # 统计页（历史成绩、趋势、成就）
  ├─ /settings   # 设置页（音效/提示/阈值/导入导出）
  └─ /about      # 关于/使用说明（可选）
```

---

## 3. 路由与跳转规则

* 首页 `/`：

  * 首次进入：显示欢迎与「开始练习」按钮 → 跳转 `/lessons`。
  * 非首次：显示「继续上次练习」按钮（读取 `lastLessonId` 与 `lastSession`），点击 → `/train/:id`。
* 课程列表 `/lessons`：点击某关卡卡片 → `/lesson/:id`。
* 课程详情 `/lesson/:id`：

  * 点击 **开始本关** → `/train/:id`。
  * 若上一关未达标（例如准确率 < 90%）：允许进入但在顶部提示“建议先复练上一关”。
* 练习页 `/train/:id`：

  * **完成或手动结束** → `/result/:id`（携带 attemptId/hash）。
  * **中途退出** → 二次确认 → 返回 `/lesson/:id`。
* 结果页 `/result/:id`：

  * 按钮：“重练本关” → `/train/:id`；“返回课程” → `/lessons`；“下一关” → `/lesson/:nextId`（若未解锁则提示条件）。
* 统计页 `/stats`：

  * 点击某次成绩可打开详情弹窗。
* 设置页 `/settings`：

  * 导入/导出数据、重置全部数据（需二次确认）。

---

## 4. 页面规格（详细）

### 4.1 首页 `/`

**模块**：

* 欢迎区：产品简介、首次引导（可选展示指法/手位示意）。
* 动态区（非首次）：显示“上次练习关卡”“上次成绩摘要”。
* 入口按钮：开始/继续、查看课程、统计、设置。

**交互要点**：

* 读取 `app.firstVisit`（无则判定首次），决定是否弹出引导。
* 若存在 `progress.lastLessonId`，显示“继续练习”。

---

### 4.2 课程列表 `/lessons`

**元素**：

* 关卡网格列表卡片（标题、目标键位/示例、解锁状态、最佳星级）。
* 顶部筛选：`全部/已解锁/未解锁/已完成`（可选）。

**规则**：

* 解锁：`lesson[i]` 的 `unlockRule`（例如：完成 `lesson[i-1]` 且准确率≥90%）。
* 卡片点击：未解锁则 toast 提示；已解锁进入 `/lesson/:id`。

---

### 4.3 课程详情 `/lesson/:id`

**展示**：

* 关卡目标（目标键位、目标准确率/目标WPM）。
* 示例内容预览（前 1~2 行）。
* 历史最佳成绩（最高星级、最高 WPM、最近一次准确率）。
* 按钮：开始本关、返回列表。

**校验**：

* 若首次进入该关且未满足前置解锁条件，顶部黄色条提示“建议先完成上一关”。

---

### 4.4 练习页 `/train/:id`（核心）

**布局**：

* 顶部栏：计时、进度条（已打/总字符）、当前 WPM、当前准确率、退出按钮。
* 主区域：

  * **目标文本区**：按字符分片渲染，正确绿色、高亮当前目标、错误红色带下划线；超出输入显示删除标识。
  * **输入区**（隐式或可视输入框）：捕获键盘事件，禁用浏览器默认快捷键（如 Ctrl+S）。
  * **键盘提示区**（可开关）：虚拟键盘 + 当前字符对应手指高亮。
* 底部：错误计数（按字符/按击键）、暂停/继续（可选）。

**逻辑**：

* 计时：开始敲击第一个有效字符时启动；暂停不计时（默认不提供暂停，避免作弊）。
* 指标：

  * `WPM = 正确字符数 / 5 / 用时(分钟)`（实时刷新，每 250ms）。
  * `Accuracy = 正确击键数 / 总击键数`。
* 错误处理：允许 Backspace 修正；是否“扣分”按配置。
* 结束条件：

  * 全文输入完成；或用户点击“结束本次”。

**防误触**：

* 屏蔽输入法候选上屏对计时的影响；建议练习用英文输入法。
* 禁止粘贴；禁止选中文本复制（选配）。

---

### 4.5 结果页 `/result/:id`

**展示**：

* 本次成绩：WPM、准确率、用时、总击键/正确/错误、错误热区（键/字母统计 TopN）。
* 星级评定：

  * 规则例：`≥95% & WPM≥30 => ★★★`，`≥90% & WPM≥20 => ★★`，否则 `★`。
* 对比卡：与该关**历史最佳**、**最近三次**的对比条。
* 行为：重练本关、下一关、返回课程。

**数据**：

* 写入 `attempts`、更新 `progress` 的最佳成绩与解锁状态。

---

### 4.6 统计页 `/stats`

**模块**：

* 概览卡：总练习时长、总尝试次数、平均 WPM、平均准确率、连续练习天数。
* 折线/柱状：按时间的 WPM/准确率趋势（仅本地渲染）。
* 关卡表：各关卡最佳成绩、最近一次成绩。
* 成就（可选）：连续打卡、首次满星、单关高于 X WPM 等。

**交互**：

* 点击某关卡 → 展示该关历史尝试弹窗列表（时间、WPM、Acc、用时）。

---

### 4.7 设置页 `/settings`

**选项**：

* 练习：是否显示键盘提示、错误提示音、输入超前是否允许、退格是否扣分。
* 目标阈值：全局目标 `targetAccuracy`、`targetWpm`（默认 90%、20 WPM，可被关卡覆盖）。
* 数据：

  * **导出**：导出所有本地数据为 JSON 文件。
  * **导入**：从 JSON 恢复（二次确认 + 版本校验）。
  * **重置**：清空全部数据（需输入 `RESET` 确认）。

---

### 4.8 关于页 `/about`（可选）

* 产品简介、快捷键说明、隐私/本地存储说明。

---

## 5. 组件清单（建议）

* `LessonCard`（关卡卡片）
* `LessonPreview`（关卡预览区）
* `Trainer`（练习核心容器）
* `TextRenderer`（目标文本渲染/高亮/滚动）
* `InputCapture`（键盘事件捕获）
* `KeyboardHint`（虚拟键盘提示）
* `MetricsHUD`（计时/WPM/Acc 顶部 HUD）
* `ResultSummary`（结果页汇总）
* `AttemptTable`（历史成绩表）
* `Charts`（趋势图，纯 Canvas/SVG）
* `ConfirmModal`（二次确认）
* `Toast`（轻提示）

---

## 6. 本地存储规范（localStorage）

> 仅使用 `localStorage`，所有 key 加 `tc.` 前缀；含**版本号**与**时间戳**，便于未来迁移。

**Key 设计**：

* `tc.app`（应用级信息）

```json
{
  "version": 1,
  "firstVisit": "2025-10-03T09:00:00.000Z",
  "lastOpen": "2025-10-03T10:12:00.000Z",
  "lastLessonId": "l02"
}
```

* `tc.settings`

```json
{
  "keyboardHint": true,
  "sound": true,
  "targetAccuracy": 0.9,
  "targetWpm": 20,
  "backspacePenalty": false
}
```

* `tc.progress`

```json
{
  "unlocked": ["l01", "l02"],
  "best": {
    "l01": {"wpm": 28, "acc": 0.94, "stars": 2},
    "l02": {"wpm": 31, "acc": 0.96, "stars": 3}
  },
  "lastAttempt": {"lessonId": "l02", "at": "2025-10-03T10:10:00Z"}
}
```

* `tc.attempts`（历史尝试，按 lesson 归档）

```json
{
  "l01": [
    {"id":"a1","at":"2025-10-01T08:00:00Z","wpm":25,"acc":0.91,"durationMs":90000,"errors":{"a":3,"s":1}},
    {"id":"a2","at":"2025-10-02T09:00:00Z","wpm":28,"acc":0.94,"durationMs":85000,"errors":{"d":2}}
  ],
  "l02": [
    {"id":"a3","at":"2025-10-03T10:10:00Z","wpm":31,"acc":0.96,"durationMs":87000,"errors":{}}
  ]
}
```

* `tc.lessons`（内置课程缓存；项目也可用常量文件直接加载）

```json
{
  "l01": {"id":"l01","title":"主键位 ASDF JKL;","content":["a s d f j k l ;", "asdf jkl; asdf jkl;"], "targetAccuracy":0.9, "targetWpm":20},
  "l02": {"id":"l02","title":"上排 QWER UIOP","content":["q w e r u i o p"], "targetAccuracy":0.9, "targetWpm":22}
}
```

**读写策略**：

* **初始化**：若不存在任何 `tc.*`，写入默认模板；存在则尊重已有。
* **写入原则**：完成一次练习→追加 `tc.attempts[lessonId]`；同时检查并更新 `tc.progress.best[lessonId]` 与 `tc.progress.unlocked`。
* **容量控制**：每关仅保留最近 N（默认 50）次尝试；超出截断旧数据。
* **数据迁移**：`tc.app.version` 变更时，在启动时做 schema 迁移（如 key 重命名、新字段默认值）。

---

## 7. 指标与星级算法

* **WPM**：`floor( 正确字符数 / 5 / 用时(分钟) )`
* **Accuracy**：`正确击键数 / 总击键数`（含 Backspace 与修正后的最终正确击键）。
* **Stars（默认规则）**：

  * `acc ≥ 0.95 && wpm ≥ 30` → ★★★
  * `acc ≥ 0.90 && wpm ≥ 20` → ★★
  * 其余 → ★

> 以上阈值可用全局设置或关卡自定义覆盖。

---

## 8. 课程数据结构（示例）

```ts
interface Lesson {
  id: string;
  title: string;
  description?: string;
  content: string[]; // 多段文本，每段独立计数/渲染
  targetAccuracy?: number; // 覆盖全局
  targetWpm?: number;      // 覆盖全局
  unlockRule?: { dependsOn?: string; minAcc?: number; minWpm?: number };
}
```

**解锁例**：`l02.unlockRule = { dependsOn: 'l01', minAcc: 0.9 }`

---

## 9. 首次引导与可访问性

* 首次进入展示 3 步引导：手位、如何开始、如何查看结果。
* **可访问性**：

  * 输入捕获支持隐藏文本框并保留 ARIA 描述。
  * 颜色+形状双编码（色盲友好）；错误下划线 + 图标提示。
  * 键盘全操作路径（Tab/Enter/Space）。

---

## 10. 性能与边界处理

* 文本渲染按“片段窗口”虚拟化，避免超长文本全部 diff 导致卡顿。
* 事件节流：WPM/Acc HUD 每 200~300ms 刷新一次。
* 输入法：建议提示切换英文输入法；若中文输入法上屏导致合成事件，需过滤非 ASCII 字符。
* 防作弊：禁用粘贴；结果页不允许手动修改；暂停默认关闭。
* 隐私：所有数据仅本地存储；设置页明确说明“清除浏览器数据会丢失记录”。

---

## 11. 验收用例（抽样）

1. **首访**：进入首页 → 点击开始 → 课程列表出现 → 选择 L01 → 进入详情 → 开始练习 → 完成 → 结果页保存记录 → 列表显示已完成与星级。
2. **解锁**：完成 L01 达标后，返回课程列表 → L02 卡片从“锁定”变“解锁”。
3. **断点恢复**：刷新页面或重开浏览器 → 首页显示“继续上次练习”，可直达 `/train/:id`。
4. **导出导入**：导出 JSON → 清空数据 → 导入 JSON → 历史、设置、解锁状态完整恢复。

---

## 12. UI 与交互（简化规范）

* 颜色：清爽对比度（浅背景、深文本）；正确/错误使用系统色系（绿/红）。
* 字体：等宽字体用于练习区，保证对齐。
* 动效：打字高亮过渡 ≤150ms；Toast 停留 2s。

---

## 13. 未来扩展预留（不在本期）

* 账号与云同步（Supabase/Firebase）。
* 多语言课程包下载与切换。
* 音频听写练习、打字游戏模式。
* 教师端/班级管理与作业下发。

---

### 附：本地存储 Key 一览

* `tc.app` / `tc.settings` / `tc.progress` / `tc.attempts` / `tc.lessons`

### 附：页面跳转一览（文案版）

* `/` → “开始练习” → `/lessons`
* `/lessons` → 点击卡片 → `/lesson/:id`
* `/lesson/:id` → “开始本关” → `/train/:id`
* `/train/:id` 完成 → `/result/:id`
* `/result/:id` → “下一关” 或 “返回课程” 或 “重练本关`
